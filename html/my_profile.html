<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <title>Мій профіль</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="../css/main_page.css">
    <style>
        /* Загальні стилі профілю */
        body { background-color: #D3CBC4; min-height: 100vh; }
        .profile-header-card { background-color: white; border-radius: 16px; padding: 1.5rem; margin-bottom: 2rem; box-shadow: 0 1px 3px rgba(0,0,0,0.05); }
        .profile-title { font-size: 2rem; font-weight: 400; color: #281822; margin-bottom: 1.5rem; }

        /* Стилі табів */
        .nav-pills { display: flex; flex-wrap: wrap; gap: 0.5rem; }
        .nav-pill {
            padding: 0.5rem 1rem;
            border-radius: 8px;
            font-size: 0.95rem;
            font-weight: 500;
            color: #281822;
            background-color: #E5E7EB;
            transition: all 0.2s;
            border: none;
            cursor: pointer;
        }
        .nav-pill:hover { background-color: #d1d5db; }
        .nav-pill.active {
            background-color: #48192E;
            color: #D3CBC4;
        }

        /* Контент табів */
        .tab-content { display: none; animation: fadeIn 0.3s ease; }
        .tab-content.active { display: block; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(5px); } to { opacity: 1; transform: translateY(0); } }

        /* Вкладка: Холодильник - Сітка */
        .fridge-container { display: grid; grid-template-columns: 300px 1fr; gap: 2rem; align-items: start; }
        @media(max-width: 1024px) { .fridge-container { grid-template-columns: 1fr; } }

        /* Рамки (Картки) для блоків холодильника */
        .magnet-panel-card {
            background: white;
            padding: 1.5rem;
            border-radius: 16px;
            height: fit-content;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.05);
        }

        .fridge-wrapper-card {
            background: white;
            padding: 1.5rem;
            border-radius: 16px;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.05);
        }

        /* Кнопки магнітів у панелі */
        .magnet-btn {
            display: flex; align-items: center; gap: 1rem;
            padding: 1rem; margin-bottom: 0.75rem;
            border-radius: 8px; color: #D3CBC4;
            cursor: grab; transition: transform 0.2s;
            user-select: none; /* Заборона виділення тексту */
        }
        .magnet-btn:hover { transform: translateX(2px); }
        .magnet-btn:active { cursor: grabbing; }

        .magnet-btn.burgundy { background-color: #48192E; }
        .magnet-btn.teal { background-color: #2D4952; }

        /* ВАЖЛИВО: Відключаємо події миші для дітей магніту, щоб drag працював коректно */
        .magnet-btn * { pointer-events: none; }

        /* Сам холодильник */
        .fridge-view {
            background-color: #f3f4f6;
            height: 600px;
            border-radius: 12px;
            position: relative;
            box-shadow: inset 0 0 20px rgba(0,0,0,0.05);
            border: 1px solid rgba(0,0,0,0.05);
            overflow: hidden;
        }
        .fridge-handle {
            position: absolute; right: 20px; top: 50%; transform: translateY(-50%);
            width: 8px; height: 120px; background-color: #281822; border-radius: 10px; opacity: 0.8;
            pointer-events: none;
        }

        /* Плейсхолдер текст */
        .fridge-placeholder {
            position: absolute;
            inset: 0;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            color: #9CA3AF;
            pointer-events: none;
            transition: opacity 0.3s;
            text-align: center;
        }
        .fridge-placeholder p { margin: 0.25rem 0; }
        .fridge-placeholder.hidden { opacity: 0; pointer-events: none; }

        /* Стиль магніту на холодильнику */
        .magnet-on-fridge {
            position: absolute;
            width: 70px;
            height: 70px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            font-size: 0.75rem;
            padding: 5px;
            cursor: grab;
            border-radius: 8px;
            text-align: center;
            line-height: 1.1;
            box-shadow: 0 4px 6px rgba(0,0,0,0.15);
            color: #D3CBC4;
            z-index: 10;
            transition: transform 0.1s;
            user-select: none;
        }
        .magnet-on-fridge:active { cursor: grabbing; transform: scale(1.05); }
        .magnet-on-fridge.burgundy { background-color: #48192E; }
        .magnet-on-fridge.teal { background-color: #2D4952; }
        .magnet-on-fridge i { font-size: 1.5rem; margin-bottom: 4px; pointer-events: none; }
        .magnet-on-fridge div { pointer-events: none; }

        /* Налаштування */
        .settings-card { background: white; border-radius: 16px; padding: 2rem; margin-bottom: 2rem; }
        .settings-title { font-size: 1.1rem; font-weight: 400; color: #281822; margin-bottom: 1rem; display: flex; align-items: center; gap: 0.5rem; }
        .settings-desc { color: #6B7280; font-size: 0.9rem; margin-bottom: 1.5rem; }

        /* Колір */
        .color-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 1rem; }
        @media(max-width: 768px) { .color-grid { grid-template-columns: 1fr; } }
        .color-option {
            border: 1px solid #E5E7EB; border-radius: 12px; padding: 0.75rem; cursor: pointer; transition: all 0.2s;
        }
        .color-option:hover { border-color: #2D4952; }
        .color-option.selected { border: 2px solid #48192E; }
        .color-preview { height: 80px; border-radius: 8px; margin-bottom: 0.5rem; }

        /* Тумблери (Switch) */
        .switch-row { display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem; }
        .toggle-switch {
            width: 44px; height: 24px; background: #E5E7EB; border-radius: 99px;
            position: relative; cursor: pointer; transition: 0.3s;
        }
        .toggle-switch.active { background: #111827; }
        .toggle-knob {
            width: 18px; height: 18px; background: white; border-radius: 50%;
            position: absolute; top: 3px; left: 3px; transition: 0.3s; box-shadow: 0 1px 2px rgba(0,0,0,0.2);
        }
        .toggle-switch.active .toggle-knob { left: 23px; }

        /* Вкладка: Інформація */
        .info-section { background: white; border-radius: 16px; padding: 2rem; margin-bottom: 2rem; }
        .avatar-circle-lg {
            width: 80px; height: 80px; border-radius: 50%; background: #48192E;
            color: #D3CBC4; font-size: 1.5rem; display: flex; align-items: center; justify-content: center;
        }
        .form-label { display: block; font-size: 0.9rem; font-weight: 500; color: #281822; margin-bottom: 0.5rem; }
        .form-input {
            width: 100%; padding: 0.75rem 1rem; border: 1px solid #E5E7EB;
            border-radius: 8px; background: #F9FAFB; color: #281822; outline: none;
        }
        .form-input:focus { border-color: #48192E; background: white; }

        .stats-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 1rem; margin-top: 2rem; }
        .stat-box { background: #F3F4F6; border-radius: 12px; padding: 1.5rem; text-align: center; }
        .stat-number { font-size: 1.8rem; font-weight: 400; color: #48192E; margin-bottom: 0.25rem; }
        .stat-label { font-size: 0.9rem; color: #6B7280; }

        /* Вкладка: Пости та Тури */
        .post-card, .tour-card-saved { background: white; border-radius: 16px; padding: 1.5rem; margin-bottom: 1.5rem; position: relative; }
        .tour-card-saved img { border-radius: 12px; height: 200px; width: 100%; object-fit: cover; margin-bottom: 1rem; }

        /* Кнопки дій */
        .btn-burgundy-outline { border: 1px solid #48192E; color: #48192E; background: transparent; padding: 0.5rem 1rem; border-radius: 8px; font-size: 0.9rem; transition: 0.2s; }
        .btn-burgundy-outline:hover { background: #48192E; color: #D3CBC4; }
        .btn-burgundy-solid { background: #48192E; color: #D3CBC4; padding: 0.5rem 1rem; border-radius: 8px; font-size: 0.9rem; border: none; cursor: pointer; }
    </style>
</head>
<body ondrop="removeMagnet(event)" ondragover="allowDrop(event)">

<script type="module" src="../js/modules/navigation.js"></script>

<main class="container-wide">
    <div class="profile-header-card">
        <h1 class="profile-title">Мій профіль</h1>
        <div class="nav-pills">
            <button class="nav-pill active" onclick="switchTab('fridge')">Мій холодильник</button>
            <button class="nav-pill" onclick="switchTab('fridge-settings')">Налаштування холодильника</button>
            <button class="nav-pill" onclick="switchTab('info')">Моя інформація</button>
            <button class="nav-pill" onclick="switchTab('my-posts')">Мої пости</button>
            <button class="nav-pill" onclick="switchTab('saved-tours')">Вибрані тури</button>
            <button class="nav-pill" onclick="switchTab('saved-posts')">Вибрані пости</button>
            <button class="nav-pill" onclick="switchTab('settings')">Налаштування</button>
        </div>
    </div>

    <!-- ВКЛАДКА: ХОЛОДИЛЬНИК -->
    <div id="tab-fridge" class="tab-content active">
        <div class="fridge-container">
            <div class="magnet-panel-card">
                <h3 class="text-lg font-normal mb-6 text-[#281822]">Доступні магніти</h3>

                <div class="magnet-btn burgundy" draggable="true" ondragstart="drag(event)" id="mag-fr" data-icon="plane" data-country="Франція" data-city="Париж"> <i class="fas fa-plane text-xl"></i> <div> <div class="font-bold text-sm">Франція</div> <div class="text-xs opacity-80">Париж</div> </div> </div>
                <div class="magnet-btn burgundy" draggable="true" ondragstart="drag(event)" id="mag-jp" data-icon="camera" data-country="Японія" data-city="Токіо">
                    <i class="fas fa-camera text-xl"></i>
                    <div>
                        <div class="font-bold text-sm">Японія</div>
                        <div class="text-xs opacity-80">Токіо</div>
                    </div>
                </div>
                <div class="magnet-btn burgundy" draggable="true" ondragstart="drag(event)" id="mag-ch" data-icon="mountain" data-country="Швейцарія" data-city="Цюріх">
                    <i class="fas fa-mountain text-xl"></i>
                    <div>
                        <div class="font-bold text-sm">Швейцарія</div>
                        <div class="text-xs opacity-80">Цюріх</div>
                    </div>
                </div>

                <div class="magnet-btn teal" draggable="true" ondragstart="drag(event)" id="mag-it" data-icon="coffee" data-country="Італія" data-city="Рим">
                    <i class="fas fa-coffee text-xl"></i>
                    <div>
                        <div class="font-bold text-sm">Італія</div>
                        <div class="text-xs opacity-80">Рим</div>
                    </div>
                </div>
                <div class="magnet-btn teal" draggable="true" ondragstart="drag(event)" id="mag-gr" data-icon="umbrella-beach" data-country="Греція" data-city="Афіни">
                    <i class="fas fa-umbrella-beach text-xl"></i>
                    <div>
                        <div class="font-bold text-sm">Греція</div>
                        <div class="text-xs opacity-80">Афіни</div>
                    </div>
                </div>
                <div class="magnet-btn teal" draggable="true" ondragstart="drag(event)" id="mag-es" data-icon="map-marker-alt" data-country="Іспанія" data-city="Барселона">
                    <i class="fas fa-map-marker-alt text-xl"></i>
                    <div>
                        <div class="font-bold text-sm">Іспанія</div>
                        <div class="text-xs opacity-80">Барселона</div>
                    </div>
                </div>

                <p class="text-sm text-gray-500 mt-6 pt-4 border-t border-gray-100">Перетягніть магніт на холодильник</p>
            </div>

            <div class="fridge-wrapper-card">
                <h3 class="text-lg font-normal mb-6 text-[#281822]">Мій холодильник</h3>
                <div class="fridge-view" id="fridge-door" ondrop="dropOnFridge(event)" ondragover="allowDrop(event)">
                    <div class="fridge-handle"></div>
                    <div id="fridge-placeholder" class="fridge-placeholder">
                        <p class="mb-1 text-lg">Перетягніть магніти сюди</p>
                        <p class="text-sm">Збирайте колекцію ваших подорожей</p>
                    </div>
                </div>
                <!-- Кнопка збереження холодильника -->
                <div class="mt-4 flex justify-end">
                    <button id="btn-save-fridge" class="btn-burgundy-solid">Зберегти розташування магнітів</button>
                </div>
            </div>
        </div>
    </div>

    <!-- ВКЛАДКА: НАЛАШТУВАННЯ ХОЛОДИЛЬНИКА -->
    <div id="tab-fridge-settings" class="tab-content">
        <div class="settings-card">
            <div class="settings-title"><i class="fas fa-palette"></i> Колір холодильника</div>
            <p class="settings-desc">Виберіть колір дверцят вашого холодильника</p>

            <div class="color-grid mb-8">
                <div class="color-option selected" onclick="changeFridgeColor('#f3f4f6', this)">
                    <div class="color-preview" style="background: #f3f4f6;"></div>
                    <div class="text-center text-sm">Класичний білий</div>
                </div>
                <div class="color-option" onclick="changeFridgeColor('#98D8C8', this)">
                    <div class="color-preview" style="background: #98D8C8;"></div>
                    <div class="text-center text-sm">Ретро м'ята</div>
                </div>
                <div class="color-option" onclick="changeFridgeColor('#E8DCC4', this)">
                    <div class="color-preview" style="background: #E8DCC4;"></div>
                    <div class="text-center text-sm">Вінтаж бежевий</div>
                </div>
                <div class="color-option" onclick="changeFridgeColor('#B5D3E7', this)">
                    <div class="color-preview" style="background: #B5D3E7;"></div>
                    <div class="text-center text-sm">Блакитна пастель</div>
                </div>
                <div class="color-option" onclick="changeFridgeColor('#F4C2C2', this)">
                    <div class="color-preview" style="background: #F4C2C2;"></div>
                    <div class="text-center text-sm">Рожева мрія</div>
                </div>
                <div class="color-option" onclick="changeFridgeColor('#A8B5B2', this)">
                    <div class="color-preview" style="background: #A8B5B2;"></div>
                    <div class="text-center text-sm">Сірий металік</div>
                </div>
            </div>
        </div>

        <div class="settings-card">
            <div class="settings-title"><i class="fas fa-lock"></i> Конфіденційність</div>
            <p class="settings-desc">Налаштуйте хто може бачити ваш холодильник</p>

            <div class="switch-row">
                <div>
                    <div class="font-bold text-[#281822] text-sm">Публічний холодильник</div>
                    <div class="text-sm text-gray-500">Дозволити всім користувачам переглядати ваш холодильник</div>
                </div>
                <div class="toggle-switch active" onclick="this.classList.toggle('active')"><div class="toggle-knob"></div></div>
            </div>
            <div class="switch-row">
                <div>
                    <div class="font-bold text-[#281822] text-sm">Дозволити коментарі</div>
                    <div class="text-sm text-gray-500">Користувачі можуть залишати коментарі під вашим холодильником</div>
                </div>
                <div class="toggle-switch active" onclick="this.classList.toggle('active')"><div class="toggle-knob"></div></div>
            </div>
        </div>
    </div>

    <!-- ВКЛАДКА: ІНФОРМАЦІЯ (Оновлена) -->
    <div id="tab-info" class="tab-content">
        <div class="info-section">
            <h3 class="text-lg font-normal mb-1 text-[#281822]">Профіль користувача</h3>
            <p class="text-sm text-gray-500 mb-6">Ця інформація буде видна іншим користувачам</p>

            <div class="flex items-center gap-6 mb-8">
                <!-- Аватар (Динамічний) -->
                <img id="profile-avatar-img" src="" class="avatar-circle-lg object-cover hidden" alt="Avatar">
                <div id="profile-avatar-placeholder" class="avatar-circle-lg">?</div>

                <div>
                    <div class="font-bold text-[#281822] mb-2 text-sm">Аватар</div>
                    <div class="flex gap-2">
                        <!-- Кнопка завантаження -->
                        <button id="btn-upload-avatar" class="btn-burgundy-outline text-xs">Завантажити фото</button>
                        <input type="file" id="avatar-input" class="hidden" accept="image/*">
                    </div>
                </div>
            </div>
        </div>

        <div class="info-section">
            <h3 class="text-lg font-normal mb-6 text-[#281822]">Особиста інформація</h3>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6">
                <div>
                    <label class="form-label"><i class="far fa-user mr-1"></i> Ім'я</label>
                    <!-- Додано ID -->
                    <input type="text" id="profile-firstname" class="form-input" placeholder="Ваше ім'я">
                </div>
                <div>
                    <label class="form-label"><i class="far fa-user mr-1"></i> Прізвище</label>
                    <!-- Додано ID -->
                    <input type="text" id="profile-lastname" class="form-input" placeholder="Ваше прізвище">
                </div>
                <div>
                    <label class="form-label"><i class="far fa-envelope mr-1"></i> Email</label>
                    <!-- Додано ID та readonly -->
                    <input type="email" id="profile-email" class="form-input bg-gray-100" readonly>
                </div>
                <div>
                    <label class="form-label"><i class="fas fa-map-marker-alt mr-1"></i> Місцезнаходження</label>
                    <!-- Додано ID -->
                    <input type="text" id="profile-location" class="form-input">
                </div>
                <div>
                    <label class="form-label"><i class="far fa-calendar mr-1"></i> Дата народження</label>
                    <div class="relative">
                        <!-- Додано ID -->
                        <input type="date" id="profile-dob" class="form-input">
                    </div>
                </div>
                <div class="md:col-span-2">
                    <label class="form-label">Про себе</label>
                    <!-- Додано ID -->
                    <textarea id="profile-bio" class="form-input" rows="3"></textarea>
                    <div class="text-xs text-gray-400 mt-1">Коротко розкажіть про себе</div>
                </div>
                <div class="md:col-span-2">
                    <label class="form-label">Інтереси в подорожах</label>
                    <!-- Додано ID -->
                    <input type="text" id="profile-interests" class="form-input" placeholder="Гори, культура, гастрономія">
                </div>
            </div>
        </div>

        <div class="info-section">
            <h3 class="text-lg font-normal text-[#281822]">Статистика подорожей</h3>
            <div class="stats-grid">
                <!-- Додано ID до блоків статистики -->
                <div class="stat-box"><div class="stat-number" id="stat-countries">0</div><div class="stat-label">Країн відвідано</div></div>
                <div class="stat-box"><div class="stat-number" id="stat-cities">0</div><div class="stat-label">Міст відвідано</div></div>
                <div class="stat-box"><div class="stat-number" id="stat-followers">0</div><div class="stat-label">Підписники</div></div>
            </div>

            <div class="flex gap-3 mt-8">
                <!-- Кнопка збереження профілю -->
                <button id="btn-save-profile" class="btn-burgundy-solid">Зберегти зміни</button>
            </div>
        </div>
    </div>

    <!-- ВКЛАДКА: МОЇ ПОСТИ -->
    <div id="tab-my-posts" class="tab-content">
        <div class="flex justify-between items-center mb-6">
            <h2 class="text-2xl text-[#281822] font-normal">Мої публікації</h2>
            <button class="btn-burgundy-solid">Створити новий пост</button>
        </div>
        <!-- JS буде додавати пости сюди -->
    </div>

    <!-- ВКЛАДКА: ЗБЕРЕЖЕНІ ТУРИ -->
    <div id="tab-saved-tours" class="tab-content">
        <div class="flex justify-between items-center mb-6">
            <div>
                <h2 class="text-2xl text-[#281822] font-normal">Вибрані тури</h2>
            </div>
            <button class="bg-white border border-gray-300 px-4 py-2 rounded-lg text-sm font-medium hover:bg-gray-50">Очистити всі</button>
        </div>
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
            <!-- JS буде додавати тури сюди -->
        </div>
    </div>

    <!-- ВКЛАДКА: ЗБЕРЕЖЕНІ ПОСТИ -->
    <div id="tab-saved-posts" class="tab-content">
        <div class="flex justify-between items-center mb-6">
            <div>
                <h2 class="text-2xl text-[#281822] font-normal">Вибрані пости</h2>
            </div>
        </div>
        <!-- JS буде додавати пости сюди -->
    </div>

    <!-- ВКЛАДКА: НАЛАШТУВАННЯ АКАУНТУ -->
    <div id="tab-settings" class="tab-content">
        <div class="settings-card">
            <div class="settings-title"><i class="fas fa-lock-open"></i> Безпека акаунту</div>
            <p class="settings-desc">Керуйте паролем та налаштуваннями безпеки</p>

            <div class="space-y-4 mb-6">
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">Поточний пароль</label>
                    <input type="password" placeholder="Введіть поточний пароль" class="w-full border p-2.5 rounded-md bg-gray-50 outline-none focus:border-[#48192E]">
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">Новий пароль</label>
                    <input type="password" placeholder="Введіть новий пароль" class="w-full border p-2.5 rounded-md bg-gray-50 outline-none focus:border-[#48192E]">
                </div>
            </div>
            <button class="btn-burgundy-solid mb-8">Змінити пароль</button>
        </div>

        <div class="settings-card">
            <div class="settings-title text-red-700">Небезпечна зона</div>
            <div class="bg-red-50 p-4 rounded-lg flex justify-between items-center border border-red-100">
                <div>
                    <div class="font-bold text-[#281822] text-sm">Видалити акаунт</div>
                    <div class="text-sm text-gray-500">Назавжди видалити ваш акаунт та всі дані</div>
                </div>
                <button class="border border-[#48192E] text-[#48192E] px-4 py-1.5 rounded-md text-sm font-medium hover:bg-red-100">Видалити</button>
            </div>
        </div>
    </div>

</main>

<script type="module" src="../js/modules/profile.js"></script>
<script type="module" src="../js/index.js"></script>

<script>
    // --- ВНУТРІШНЯ ЛОГІКА ІНТЕРФЕЙСУ ТА DRAG-N-DROP ---

    function switchTab(tabName) {
        document.querySelectorAll('.nav-pill').forEach(btn => btn.classList.remove('active'));
        // Fix: Use strict check for tabName including quotes to avoid partial matches (e.g. 'settings' matching 'fridge-settings')
        const targetBtn = Array.from(document.querySelectorAll('.nav-pill')).find(b => b.getAttribute('onclick')?.includes(`'${tabName}'`));
        if(targetBtn) targetBtn.classList.add('active');

        document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
        document.getElementById('tab-' + tabName)?.classList.add('active');
    }

    // Drag & Drop Logic
    function allowDrop(ev) { ev.preventDefault(); }

    function drag(ev) {
        // Передаємо ID елемента, який перетягуємо
        ev.dataTransfer.setData("text", ev.currentTarget.id);
    }

    function dropOnFridge(ev) {
        ev.preventDefault();
        ev.stopPropagation();

        var data = ev.dataTransfer.getData("text");
        if(!data) return;

        var original = document.getElementById(data);
        if (!original) return;

        var rect = ev.currentTarget.getBoundingClientRect();
        var x = ev.clientX - rect.left;
        var y = ev.clientY - rect.top;

        // 1. Якщо це новий магніт з панелі
        if (original.classList.contains('magnet-btn')) {
            var nodeCopy = document.createElement('div');
            nodeCopy.id = "magnet-on-fridge-" + new Date().getTime();
            nodeCopy.classList.add("magnet-on-fridge");

            // Копіюємо класи кольору
            if(original.classList.contains('burgundy')) nodeCopy.classList.add('burgundy');
            else if(original.classList.contains('teal')) nodeCopy.classList.add('teal');

            const iconClass = original.getAttribute('data-icon');
            const city = original.getAttribute('data-city');
            const country = original.getAttribute('data-country');

            // ВАЖЛИВО: Зберігаємо дані в dataset для JS-логіки збереження
            nodeCopy.dataset.city = city;
            nodeCopy.dataset.country = country;
            nodeCopy.dataset.iconClass = iconClass;

            nodeCopy.innerHTML = `<i class="fas fa-${iconClass}"></i><div class="magnet-city">${city}</div><div class="magnet-country">${country}</div>`;

            // Центруємо магніт відносно курсору (35px - половина ширини/висоти)
            nodeCopy.style.left = (x - 35) + 'px';
            nodeCopy.style.top = (y - 35) + 'px';

            nodeCopy.setAttribute('draggable', 'true');
            nodeCopy.ondragstart = drag;

            ev.currentTarget.appendChild(nodeCopy);

            document.getElementById('fridge-placeholder').classList.add('hidden');
        }
        // 2. Якщо переміщуємо вже існуючий магніт
        else if (original.classList.contains('magnet-on-fridge')) {
            original.style.left = (x - 35) + 'px';
            original.style.top = (y - 35) + 'px';
        }
    }

    function removeMagnet(ev) {
        ev.preventDefault();
        var data = ev.dataTransfer.getData("text");
        if(!data) return;

        var element = document.getElementById(data);

        // Видаляємо тільки якщо це магніт на холодильнику (а не кнопка в меню)
        if (element && element.classList.contains('magnet-on-fridge')) {
            element.remove();

            const fridge = document.getElementById('fridge-door');
            const remainingMagnets = fridge.querySelectorAll('.magnet-on-fridge');
            if (remainingMagnets.length === 0) {
                document.getElementById('fridge-placeholder').classList.remove('hidden');
            }
        }
    }

    function changeFridgeColor(color, element) {
        document.getElementById('fridge-door').style.backgroundColor = color;
        document.querySelectorAll('.color-option').forEach(opt => opt.classList.remove('selected'));
        element.classList.add('selected');
    }
</script>
<script src="https://cdn.socket.io/4.7.4/socket.io.min.js"></script>
</body>
</html>